#!/home/savoirvi/bin/mksh

list="\
$(find src/*/ -type f -name index.txt -o -name index.wshtml 2> /dev/null \
| sort \
| cut -d '/' -f 2 \
| while read dir; do
	printf '%s\n' "\<dl\>\<dt\>\<a\ href\=\"\\/$dir\\/\"\>$(print $dir \
	| tr '-' ' ')\<\\/a\>\<\\/dt\><\\/dl\>\\"
	find src/$dir/ -type f \( -name *.txt -o -name *.wshtml \) ! -name index.* 2> /dev/null \
	| sort \
	| while read file; do
		t="$(printf '%s' "$file" | sed 's#.*/##')"
		printf '%s' "\\<dd\>\<a\ href\=\"\\/$dir\\/"
		printf '%s' "$t" | sed -e 's/\.txt$/\.html/' -e 's/\.wshtml$/\.html/'
		printf '%s\n' "\"\>$t\<\\/a\>\<\\/dd\>\\"
	done
done)"

# escape: $.*[\]^&/

menu="<nav>\\
$list
<\\/nav>\\
<div id=\"paper\">\\
<article>"

sed -e "s/<div>FOO<\/div>/$menu/" scripts/layout > includes/layout
