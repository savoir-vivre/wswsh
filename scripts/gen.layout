#!/home/savoirvi/bin/mksh

list="\
$(find src/*/ -type f -name index.txt -o -name index.wshtml 2> /dev/null \
| sort \
| cut -d '/' -f 2 \
| while read dir; do
	printf '%s\n' "\<li\>\<a\ href\=\"\\/$dir\\/\"\>$(print $dir \
	| tr '-' ' ')\<\\/a\>\\<ul\>\\"
	find src/$dir/ -type f \( -name *.txt -o -name *.wshtml \) ! -name index.* 2> /dev/null \
	| sort \
	| while read file; do
		t="$(printf '%s' "$file" | sed 's#.*/##')"
		printf '%s' "\\<li\>\<a\ href\=\"\\/$dir\\/"
		printf '%s' "$t" | sed -e 's/\.txt$/\.html/' -e 's/\.wshtml$/\.html/' -e 's/\ /\%20/'
		printf '%s\n' "\"\>$t\<\\/a\>\<\\/li\>\\"
	done
	printf '%s\n' "\<\\/ul\><\\/li\>\\"
done)"

# escape: $.*[\]^&/

menu="<nav>\\
<ul>\\
$list
<\\/ul>\\
<\\/nav>\\
<div id=\"paper\">\\
<article>"

sed -e "s/<div>FOO<\/div>/$menu/" scripts/layout > includes/layout
